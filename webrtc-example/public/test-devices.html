<!DOCTYPE html>
<html>
<head>
    <title>Test Media Devices</title>
</head>
<body>
    <h1>Media Devices Test</h1>
    <div id="devices"></div>
    <button onclick="listDevices()">List Available Devices</button>
    <button onclick="testMedia()">Test Media Access</button>
    <video id="testVideo" autoplay muted style="width: 300px; height: 200px; background: black;"></video>
    
    <script>
        async function listDevices() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const deviceList = document.getElementById('devices');
                deviceList.innerHTML = '<h2>Available Devices:</h2>';
                
                devices.forEach(device => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <strong>${device.kind}:</strong> ${device.label || 'No label'} 
                        (ID: ${device.deviceId})<br>
                    `;
                    deviceList.appendChild(div);
                });
                
                console.log('Available devices:', devices);
            } catch (error) {
                console.error('Error listing devices:', error);
                document.getElementById('devices').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        }
        
        async function testMedia() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                document.getElementById('testVideo').srcObject = stream;
                console.log('Media access successful!');
                console.log('Stream tracks:', stream.getTracks());
                
                // Stop after 5 seconds
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                }, 5000);
                
            } catch (error) {
                console.error('Media access error:', error);
                alert('Media access failed: ' + error.message);
            }
        }
        
        // Auto-run on page load
        window.onload = () => {
            listDevices();
        };
    </script>
</body>
</html>
