import{u as F,t as B,q as M,d as _,B as T,z as a,a as E,J as I,b as P,C,Z as k,c as b,e as v,T as N,p as S,f as R}from"./index-B1f6toGc.js";const J=()=>{const{address:A,chainId:f}=F(),c=()=>{if(f!==T)throw new Error(`Please switch to BSC Mainnet (ChainID: ${T})`)},s=async()=>{if(!window.ethereum)throw new Error("Wallet not connected");c();const e=await new v(window.ethereum).getSigner();return new C(k,b,e)},l=()=>{const r=new I(P);return new C(k,b,r)};return{getTradeDetails:async r=>{try{const t=await l().trades(r);return{id:t.id.toString(),adPoster:t.adPoster,counterParty:t.counterParty,seller:t.seller,buyer:t.buyer,token:t.token,amount:R(t.amount,18),adType:t.adType,status:t.status,expiryTime:Number(t.expiryTime)}}catch(e){throw console.error("Error getting trade details:",e),e}},getTradeCounter:async()=>{try{const e=await l().tradeCounter();return Number(e)}catch(r){throw console.error("Error getting trade counter:",r),r}},isTokenAllowed:async r=>{try{return await l().allowedTokens(r)}catch(e){throw console.error("Error checking token allowance:",e),e}},createTrade:async(r,e,t,n="0x0000000000000000000000000000000000000000")=>{var u,w;try{c();const o=await s(),g=N[e].address,h=await o.createTrade(r,g,S(t,18),n);a.loading("Creating trade on blockchain...",{id:"create-trade"});const d=await h.wait(),p=d.logs.find(i=>{try{const m=o.interface.parseLog(i);return(m==null?void 0:m.name)==="TradeCreated"}catch{return!1}});let y;if(p){const i=o.interface.parseLog(p);y=(w=(u=i==null?void 0:i.args)==null?void 0:u.tradeId)==null?void 0:w.toString()}return a.success("Trade created on blockchain!",{id:"create-trade"}),{transactionHash:d.hash,blockNumber:d.blockNumber,tradeId:y}}catch(o){throw console.error("Create trade error:",o),a.error(o.message||"Failed to create trade",{id:"create-trade"}),o}},lockFunds:async r=>{try{c();const t=await(await s()).lockFunds(r);a.loading("Locking funds...",{id:"lock-funds"});const n=await t.wait();return a.success("Funds locked successfully!",{id:"lock-funds"}),{transactionHash:n.hash,blockNumber:n.blockNumber}}catch(e){throw console.error("Lock funds error:",e),a.error(e.message||"Failed to lock funds",{id:"lock-funds"}),e}},releaseFunds:async r=>{try{c();const t=await(await s()).releaseFunds(r);a.loading("Releasing funds...",{id:"release-funds"});const n=await t.wait();return a.success("Funds released successfully!",{id:"release-funds"}),{transactionHash:n.hash,blockNumber:n.blockNumber}}catch(e){throw console.error("Release funds error:",e),a.error(e.message||"Failed to release funds",{id:"release-funds"}),e}},cancelTrade:async r=>{try{c();const t=await(await s()).cancelTrade(r);a.loading("Cancelling trade...",{id:"cancel-trade"});const n=await t.wait();return a.success("Trade cancelled!",{id:"cancel-trade"}),{transactionHash:n.hash,blockNumber:n.blockNumber}}catch(e){throw console.error("Cancel trade error:",e),a.error(e.message||"Failed to cancel trade",{id:"cancel-trade"}),e}},approveToken:async(r,e)=>{try{if(c(),r==="BNB")return a.success("BNB is native token - no approval needed!"),null;if(!window.ethereum)throw new Error("Provider not available");const t=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"],u=await new v(window.ethereum).getSigner(),w=N[r].address,o=new C(w,t,u),g=await o.allowance(A,k),h=S(e,18);if(g>=h)return a.success("Token already approved!"),null;const d=await o.approve(k,h);a.loading("Approving token...",{id:"approve-token"});const p=await d.wait();return a.success("Token approved!",{id:"approve-token"}),p.hash}catch(t){throw console.error("Approve token error:",t),a.error(t.message||"Failed to approve token",{id:"approve-token"}),t}},getContract:s,getReadOnlyContract:l,isMainnet:f===T,debugContract:_,quickCheck:M,testFunction:B,switchToMainnet:async()=>{try{if(!window.ethereum)throw new Error("Wallet provider not found");return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x38"}]}),a.success("Switched to BSC Mainnet"),!0}catch(r){if((r==null?void 0:r.code)===4902||/Unrecognized chain/.test(String((r==null?void 0:r.message)||"")))try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[E]}),a.success("BSC Mainnet added and switched"),!0}catch(e){return console.error("Failed to add BSC Mainnet:",e),a.error("Failed to add BSC Mainnet"),!1}return console.error("Failed to switch network:",r),a.error("Failed to switch to BSC Mainnet"),!1}}}};export{J as useZotrustContract};
